<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GLFL Standings</title>
<!-- ========================================================================================== LINKED STYLESHEETS ================== -->
<link rel="stylesheet" href="../css/global.css">
<link rel="stylesheet" href="../css/tables.css">
	
</head>

<body>

<!-- ========================================================================================== LOGO BAR ================== -->
<div class="team-logo-bar">
	<div class="team-logo-container">
	<a href="Teams/Boston.html"><img src="../images/Boston.png" alt="Boston" /></a>
	<a href="Teams/Brooklyn.html"><img src="../images/Brooklyn.png" alt="Brooklyn" /></a>
	<a href="Teams/CedarRapids.html"><img src="../images/CedarRapids.png" alt="Cedar Rapids" /></a>
	<a href="Teams/Chicago.html"><img src="../images/Chicago.png" alt="Chicago" /></a>
	<a href="Teams/Cleveland.html"><img src="../images/Cleveland.png" alt="Cleveland" /></a>
	<a href="Teams/LosAngeles.html"><img src="../images/LosAngeles.png" alt="Los Angeles" /></a>
	<a href="Teams/Miami.html"><img src="../images/Miami.png" alt="Miami" /></a>
	<a href="Teams/Milwaukee.html"><img src="../images/Milwaukee.png" alt="Milwaukee" /></a>
	<a href="Teams/NorthernArizona.html"><img src="../images/NorthernArizona.png" alt="Northern Arizona" /></a>
	<a href="Teams/Philadelphia.html"><img src="../images/Philadelphia.png" alt="Philadelphia" /></a>
	<a href="Teams/Tucson.html"><img src="../images/Tucson.png" alt="Tucson" /></a>
	<a href="Teams/Vegas.html"><img src="../images/Vegas.png" alt="Vegas" /></a>
	</div>
</div>

<!-- ========================================================================================== MAIN NAV ================== -->
<nav class="main-nav">
<div class="nav-container">

	<a href="../index.html" class="logo">
	<img src="../images/Logo.png" alt="League Logo" />
	</a>

<input type="checkbox" id="menu-toggle" class="menu-toggle" aria-label="Toggle menu" />
<label for="menu-toggle" class="hamburger">&#9776;</label>

<!-- Nav Links -->
<ul class="nav-links">
<li class="dropdown">
	<a href="#">About</a>
	<ul class="dropdown-content">
		<li><a href="About.html">Who We Are</a></li>
		<li><a href="Bylaws.html">Bylaws</a></li>
	</ul>
</li>

<li><a href="News.html">News</a></li>

<li class="dropdown">
	<a href="#">History</a>
	<ul class="dropdown-content">
		<li><a href="History.html">History of the GLFL</a></li>
		<li><a href="Seasons.html">GLFL Seasons</a></li>
		<li><a href="Champions.html">GLFL Champions</a></li>
		<li><a href="Awards.html">Individual Award Winners</a></li>
		<li><a href="RecordBook.html">Record Book</a></li>
	</ul>
</li>

<li class="dropdown">
	<a href="#">Schedule &amp; Standings</a>
	<ul class="dropdown-content">
		<li><a href="Standings.html">Standings</a></li>
		<li><a href="WeeklySchedule.html">Weekly Schedule</a></li>
	</ul>
</li>

	<li><a href="Teams.html">Teams</a></li>
	<li><a href="Draft.html">Draft</a></li>
</ul>
</div>
</nav>

<div class="text-container">

<h3>Standings</h3>
<div id="standings-container">
<div class="loading">Loading Standings...</div>
	<table class="standard-table">
		<thead>
			<tr>
				<th>Rank</th>
				<th>Team</th>
				<th>Wins</th>
				<th>Losses</th>
				<th>Points For</th>
			</tr>
		</thead>

		<tbody>

		</tbody>
	</table>
</div>

<h3>Playoff Odds</h3>
<div id="playoff-odds-container">
<div class="loading">Loading playoff odds...</div>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", async function() {

  // ========================================================================================== MOBILE NAVIGATION ==================
  const hamburger = document.querySelector(".hamburger");
  const navLinks = document.querySelector(".nav-links");
  const dropdownLinks = document.querySelectorAll(".nav-links .dropdown > a");

  hamburger.addEventListener("click", function(e) {
    e.stopPropagation();
    navLinks.classList.toggle("nav-active");
  });

  dropdownLinks.forEach(link => {
    link.addEventListener("click", function(e) {
      if (window.innerWidth <= 768) {
        e.preventDefault();
        const submenu = this.nextElementSibling;
        submenu.classList.toggle("dropdown-active");
      }
    });
  });

  document.addEventListener("click", function(e) {
    if (window.innerWidth <= 768) {
      const isClickInsideNav = navLinks.contains(e.target) || hamburger.contains(e.target);
      if (!isClickInsideNav) {
        navLinks.classList.remove("nav-active");
        document.querySelectorAll(".dropdown-content").forEach(sub => sub.classList.remove("dropdown-active"));
      }
    }
  });

  // ========================================================================================== STANDINGS ==================
  const STANDINGS_CSV = "https://raw.githubusercontent.com/michaelj86768894/big12/main/standings.csv";
  const container = document.getElementById("standings-container");
  const loading = document.querySelector(".loading");

  try {
    const res = await fetch(STANDINGS_CSV);
    const csv = await res.text();

    const rows = csv.trim().split(/\r?\n/);
    rows.shift(); // remove header

    const standings = {};

    rows.forEach(row => {
      const [team1, team2, score1, score2, div1, div2] = row.split(",").map(x => x.trim());
      const s1 = parseFloat(score1) || 0;
      const s2 = parseFloat(score2) || 0;

      if (!standings[team1]) standings[team1] = { wins: 0, losses: 0, pf: 0, division: div1 };
      if (!standings[team2]) standings[team2] = { wins: 0, losses: 0, pf: 0, division: div2 };

      standings[team1].pf += s1;
      standings[team2].pf += s2;

      if (s1 > s2) {
        standings[team1].wins++;
        standings[team2].losses++;
      } else if (s2 > s1) {
        standings[team2].wins++;
        standings[team1].losses++;
      }
    });

    const sorted = Object.entries(standings)
      .map(([team, stats]) => ({ team, ...stats }))
      .sort((a,b) => b.wins - a.wins || b.pf - a.pf);

    const divisions = {
      East: sorted.filter(t => t.division.toLowerCase() === "east"),
      Central: sorted.filter(t => t.division.toLowerCase() === "central"),
      West: sorted.filter(t => t.division.toLowerCase() === "west")
    };

    container.innerHTML = "";

    Object.entries(divisions).forEach(([name, teams]) => {
      if (!teams.length) return;

      const table = document.createElement("table");
      table.className = "standard-table";

      table.innerHTML = `
        <thead>
          <tr><th colspan="5">${name} Division</th></tr>
          <tr>
            <th>#</th><th>Team</th><th>W</th><th>L</th><th>PF</th>
          </tr>
        </thead>
      `;

      const tbody = document.createElement("tbody");
      teams.forEach((t, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${t.team}</td>
          <td>${t.wins}</td>
          <td>${t.losses}</td>
          <td>${t.pf.toFixed(1)}</td>
        `;
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      container.appendChild(table);
    });

    if (loading) loading.style.display = "none";

  } catch(err) {
    console.error(err);
    if (loading) loading.textContent = "Error loading standings.";
  }

  // ========================================================================================== PLAYOFF ODDS ==================
  const PLAYOFF_ODDS_CSV = "https://raw.githubusercontent.com/michaelj86768894/big12/main/playoffodds.csv";
  const oddsContainer = document.getElementById("playoff-odds-container");

  if (!oddsContainer) return;

  try {
    const res = await fetch(PLAYOFF_ODDS_CSV);
    const csv = await res.text();

    const rows = csv.trim().split(/\r?\n/);
    const headers = rows.shift().split(",");

    const data = rows.map(r => {
      const values = r.split(",");
      const obj = {};
      headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
      obj.Total = parseFloat(obj.Total) || 0;
      return obj;
    });

    // Sort descending by Total
    data.sort((a, b) => b.Total - a.Total);

    // Build table
    const table = document.createElement("table");
    table.className = "scrolling-table";

    const thead = document.createElement("thead");
    thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    data.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = headers.map(h => `<td>${row[h]}</td>`).join("");
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    // ===== WRAP TABLE IN SCROLL CONTAINER =====
    const scrollWrapper = document.createElement("div");
    scrollWrapper.className = "scrolling-table-scroll"; // <-- wrapper for horizontal scrolling
    scrollWrapper.appendChild(table);
    oddsContainer.innerHTML = "";
    oddsContainer.appendChild(scrollWrapper);

  } catch (err) {
    console.error(err);
    oddsContainer.textContent = "Error loading playoff odds.";
  }

});
</script>

</body>
</html>
